dist: trusty
language: java

cache:
  directories:
  - $HOME/.m2
  - frontend/src/bower_components
  - frontend/src/node_modules
  - integration/rocket-chat/node_modules

services:
  - mongodb

jdk:
  - openjdk8

before_install:
  - gem install sass
  - gem install compass

install:
  - mvn -B clean install -Dquick

script:
  - mvn -B -DargLine="-Xmx2g" test

after_success:
  - test ${TRAVIS_PULL_REQUEST:-true} = false -a ${TRAVIS_BRANCH:-HEAD} = master -o ${TRAVIS_BRANCH:-HEAD} = documentation
    && cd docs/target/html
    && git init
    && git config user.name $GH_USER_NAME
    && git config user.email $GH_USER_EMAIL
    && git add . ; git commit -m "Update gh-pages after commit $TRAVIS_COMMIT to $TRAVIS_BRANCH"
    && git push --force --quiet "https://$GH_TOKEN@$GH_REF" master:gh-pages > /dev/null 2>&1
